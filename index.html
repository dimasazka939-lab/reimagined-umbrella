<script>
const adminNumber = "6285147769300";
let rgbColors = ['#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff'];
let lampFull = document.getElementById('rgbLampFull');
let i = 0;
let rgbInterval = null;
let rgbOn = false;

// RGB Functions
function startRGB() {
    stopRGB();
    rgbInterval = setInterval(()=>{
        lampFull.style.background = rgbColors[i % rgbColors.length];
        i++;
    }, 300);
    rgbOn = true;
}

function startRGBFull() {
    stopRGB();
    lampFull.style.background = "linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet)";
    rgbOn = true;
}

function stopRGB() {
    if(rgbInterval) {
        clearInterval(rgbInterval);
        rgbInterval = null;
    }
    lampFull.style.background = "transparent";
    rgbOn = false;
}

function toggleRGB() {
    if(rgbOn) stopRGB();
    else startRGBFull();
}

// Transactions
function loadTransactions() {
    const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
    const list = document.getElementById('transactionList');
    list.innerHTML = '';
    transactions.forEach((t,index)=>{
        list.innerHTML += `<div class="transaction">
            <p><b>${t.game}</b> | ID: ${t.username} | Paket: ${t.package}</p>
            <p>Status: <span class="status" id="status${index}">${t.status}</span></p>
        </div>`;
    });
}

function saveTransaction(transaction){
    const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
    transactions.push(transaction);
    localStorage.setItem('transactions', JSON.stringify(transactions));
    loadTransactions();
}

function updateTransactionStatus(index,status){
    const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
    if(transactions[index]){
        transactions[index].status = status;
        localStorage.setItem('transactions', JSON.stringify(transactions));
        const statusEl = document.getElementById('status'+index);
        if(statusEl) statusEl.innerText = status;
    }
}

function processOrder(){
    const game = document.getElementById('game').value;
    const user = document.getElementById('username').value;
    const region = document.getElementById('region').value;
    const packageSelected = document.getElementById('package').value;
    const payment = document.getElementById('payment').value;

    if(!user || !region){
        alert("Masukkan ID Game dan Region terlebih dahulu!");
        return;
    }

    const transaction = {game,user,region,package:packageSelected,payment,status:"Menunggu Bayar",id:Date.now()};
    saveTransaction(transaction);

    const waLink = `https://wa.me/${adminNumber}?text=${encodeURIComponent(
        "Order Baru:\nGame: " + game +
        "\nID: " + user +
        "\nRegion: " + region +
        "\nPaket: " + packageSelected +
        "\nMetode: " + payment
    )}`;

    let info = `<p>Jika WhatsApp tidak otomatis terbuka, klik link berikut:</p>`;
    info += `<p><a href="${waLink}" target="_blank">Konfirmasi Order ke Admin</a></p>`;
    if(payment === "QR"){
        info += `<p>Scan QR Code berikut:</p>`;
        info += `<img src="https://via.placeholder.com/150?text=QR+Code" alt="QR Code">`;
    }
    document.getElementById('paymentInfo').innerHTML = info;
    document.getElementById('paymentInfo').style.display = 'block';

    window.open(waLink, "_blank");

    // Simulasi pembayaran berhasil
    setTimeout(()=>{
        const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
        const index = transactions.findIndex(t => t.id === transaction.id);
        if(index >= 0){
            updateTransactionStatus(index,"Sedang Proses");
            startRGBFull();
            setTimeout(()=>{
                updateTransactionStatus(index,"Selesai");
                stopRGB();
            },10000);
        }
    },5000);
}

loadTransactions();
</script>